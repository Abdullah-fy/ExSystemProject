@model ExSystemProject.Models.BranchDashboardViewModel
@{
    ViewData["Title"] = $"{Model.BranchName} Branch Dashboard";
    Layout = "~/Views/Shared/_BranchManagerLayout.cshtml";
}

<div class="container-fluid px-4">
    <h1 class="mt-4">@Model.BranchName Branch Dashboard</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item active">Branch Overview</li>
    </ol>

    <!-- Statistics Cards -->
    <div class="row">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2 border-left-primary">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-uppercase mb-1">Students</div>
                            <div class="h5 mb-0 fw-bold">@Model.StudentCount</div>
                            <div class="small text-muted">Active Students</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-people-fill fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2 border-left-success">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-uppercase mb-1">Instructors</div>
                            <div class="h5 mb-0 fw-bold">@Model.InstructorCount</div>
                            <div class="small text-muted">Active Instructors</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-workspace fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2 border-left-info">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-uppercase mb-1">Courses</div>
                            <div class="h5 mb-0 fw-bold">@Model.CourseCount</div>
                            <div class="small text-muted">Active Courses</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-book fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2 border-left-warning">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-uppercase mb-1">Exams</div>
                            <div class="h5 mb-0 fw-bold">@Model.ExamCount</div>
                            <div class="small text-muted">Total Exams</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-file-earmark-text fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-xl-6 col-md-6 mb-4">
            <div class="card shadow h-100 py-2 border-left-primary">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-uppercase mb-1">Tracks</div>
                            <div class="h5 mb-0 fw-bold">@Model.TrackCount</div>
                            <div class="small text-muted">Active Tracks</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-diagram-3 fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6 col-md-6 mb-4">
            <div class="card shadow h-100 py-2 border-left-success">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-uppercase mb-1">Supervisors</div>
                            <div class="h5 mb-0 fw-bold">@Model.SupervisorCount</div>
                            <div class="small text-muted">Active Supervisors</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-badge-fill fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow mb-4">
                <div class="card-header">
                    <i class="bi bi-graph-up me-1"></i>
                    Branch Performance Metrics
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card border-left-info h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-xs fw-bold text-uppercase mb-1">Pass Rate</h6>
                                            <div class="h5 mb-0 fw-bold">@Model.PassRate%</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-award fa-2x text-info"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-2" style="height: 8px;">
                                        <div class="progress-bar bg-info" role="progressbar" style="width: @Model.PassRate%" aria-valuenow="@Model.PassRate" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card border-left-warning h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-xs fw-bold text-uppercase mb-1">Course Completion</h6>
                                            <div class="h5 mb-0 fw-bold">@Model.CourseCompletionRate%</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-check-circle fa-2x text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-2" style="height: 8px;">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: @Model.CourseCompletionRate%" aria-valuenow="@Model.CourseCompletionRate" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card border-left-success h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-xs fw-bold text-uppercase mb-1">Average Grade</h6>
                                            <div class="h5 mb-0 fw-bold">@Model.AverageGrade%</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-bar-chart fa-2x text-success"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-2" style="height: 8px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: @Model.AverageGrade%" aria-valuenow="@Model.AverageGrade" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row">
        <div class="col-xl-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-bar-chart-line me-1"></i>
                    Students per Track
                </div>
                <div class="card-body">
                    <canvas id="studentsPerTrackChart" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>
        <div class="col-xl-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-pie-chart me-1"></i>
                    Exam Results Distribution
                </div>
                <div class="card-body">
                    <canvas id="examResultsChart" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="bi bi-lightning-charge me-1"></i>
            Quick Actions
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-2">
                    <a asp-controller="BranchManagerStudent" asp-action="Index" class="btn btn-primary w-100">
                        <i class="bi bi-people me-2"></i> Manage Students
                    </a>
                </div>
                <div class="col-md-3 mb-2">
                    <a asp-controller="BranchManagerInstructor" asp-action="Index" class="btn btn-success w-100">
                        <i class="bi bi-person-workspace me-2"></i> Manage Instructors
                    </a>
                </div>
                <div class="col-md-3 mb-2">
                    <a asp-controller="BranchManagerTrack" asp-action="Index" class="btn btn-info w-100">
                        <i class="bi bi-diagram-3 me-2"></i> Manage Tracks
                    </a>
                </div>
                <div class="col-md-3 mb-2">
                    <a asp-controller="BranchManagerCourse" asp-action="Index" class="btn btn-warning w-100">
                        <i class="bi bi-book me-2"></i> Manage Courses
                    </a>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-4 mb-2">
                    <a asp-controller="BranchManagerExam" asp-action="Index" class="btn btn-primary w-100">
                        <i class="bi bi-file-earmark-text me-2"></i> Manage Exams
                    </a>
                </div>
                <div class="col-md-4 mb-2">
                    <a asp-controller="BranchManagerSupervisor" asp-action="Index" class="btn btn-success w-100">
                        <i class="bi bi-person-badge-fill me-2"></i> Manage Supervisors
                    </a>
                </div>
                <div class="col-md-4 mb-2">
                    <a asp-controller="BranchManagerReport" asp-action="Index" class="btn btn-info w-100">
                        <i class="bi bi-file-earmark-bar-graph me-2"></i> Branch Reports
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .border-left-primary {
            border-left: 4px solid #a41e22 !important;
        }

        .border-left-success {
            border-left: 4px solid #1e3a47 !important;
        }

        .border-left-info {
            border-left: 4px solid #2a7d8c !important;
        }

        .border-left-warning {
            border-left: 4px solid #f6c23e !important;
        }

        .text-xs {
            font-size: 0.7rem;
        }

        .text-primary {
            color: #a41e22 !important;
        }

        .text-success {
            color: #1e3a47 !important;
        }

        .text-info {
            color: #2a7d8c !important;
        }

        .text-warning {
            color: #f6c23e !important;
        }

        .btn-primary {
            background-color: #a41e22;
            border-color: #a41e22;
        }

            .btn-primary:hover {
                background-color: #8a1a1e;
                border-color: #8a1a1e;
            }

        .btn-success {
            background-color: #1e3a47;
            border-color: #1e3a47;
        }

            .btn-success:hover {
                background-color: #19313d;
                border-color: #19313d;
            }

        .btn-info {
            background-color: #2a7d8c;
            border-color: #2a7d8c;
            color: white;
        }

            .btn-info:hover {
                background-color: #236b78;
                border-color: #236b78;
                color: white;
            }
    </style>
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Students per Track Chart
        const trackLabels = @Html.Raw(Json.Serialize(Model.TrackNames));
        const studentsPerTrack = @Html.Raw(Json.Serialize(Model.StudentsPerTrack));

        const studentsPerTrackChart = new Chart(document.getElementById("studentsPerTrackChart"), {
            type: 'bar',
            data: {
                labels: trackLabels,
                datasets: [{
                    label: 'Students',
                    backgroundColor: '#a41e22',
                    borderColor: '#a41e22',
                    data: studentsPerTrack,
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // Exam Results Distribution Chart
        const examResultsChart = new Chart(document.getElementById("examResultsChart"), {
            type: 'doughnut',
            data: {
                labels: ['Passed', 'Failed', 'Not Taken'],
                datasets: [{
                    data: [@Model.PassedExams, @Model.FailedExams, @Model.NotTakenExams],
                    backgroundColor: ['#1e3a47', '#a41e22', '#6c757d'],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });
    </script>
}
