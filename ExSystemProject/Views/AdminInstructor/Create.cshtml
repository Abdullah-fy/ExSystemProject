@model ExSystemProject.DTOS.InstructorDTO
@{
    ViewData["Title"] = "Create Instructor";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2>Create New Instructor</h2>

            <div class="card">
                <div class="card-body">
                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="alert alert-danger">
                            <ul>
                                @foreach (var state in ViewData.ModelState)
                                {
                                    @foreach (var error in state.Value.Errors)
                                    {
                                        <li>@error.ErrorMessage</li>
                                    }
                                }
                            </ul>
                        </div>
                    }

                    <form method="post">
                        <!-- Basic fields -->
                        <div class="form-group mb-3">
                            <label for="Username">Username</label>
                            <input type="text" id="Username" name="Username" class="form-control" required />
                        </div>

                        <div class="form-group mb-3">
                            <label for="Email">Email</label>
                            <input type="email" id="Email" name="Email" class="form-control" required />
                        </div>

                        <div class="form-group mb-3">
                            <label for="Gender">Gender</label>
                            <select id="Gender" name="Gender" class="form-control" required>
                                <option value="">-- Select Gender --</option>
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="Salary">Salary</label>
                            <input type="number" id="Salary" name="Salary" class="form-control" step="0.01" min="0" required />
                        </div>

                        <div class="form-group mb-3">
                            <label for="BranchId">Branch</label>
                            <select id="BranchId" name="BranchId" class="form-control" required onchange="loadTracks()">
                                <option value="">-- Select Branch --</option>
                                @foreach (var branch in ViewBag.Branches)
                                {
                                    <option value="@branch.Value">@branch.Text</option>
                                }
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="TrackId">Track</label>
                            <select id="TrackId" name="TrackId" class="form-control" required>
                                <option value="">-- First Select Branch --</option>
                            </select>
                        </div>

                        <!-- Required hidden fields with default values -->
                        <input type="hidden" name="Isactive" value="true" />
                        <input type="hidden" name="TrackName" value="Selected Track" />
                        <input type="hidden" name="BranchName" value="Selected Branch" />
                        <input type="hidden" name="ImageUrl" value="default.jpg" />

                        <div class="mt-3">
                            <button type="submit" class="btn btn-primary">Create Instructor</button>
                            <a href="/AdminInstructor" class="btn btn-secondary">Back to List</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Simple function to load tracks
    function loadTracks() {
        var branchId = document.getElementById('BranchId').value;
        var trackDropdown = document.getElementById('TrackId');

        // Clear dropdown
        trackDropdown.innerHTML = '<option value="">Loading...</option>';

        if (!branchId) {
            trackDropdown.innerHTML = '<option value="">-- First Select Branch --</option>';
            return;
        }

        // Use fetch API
        fetch('/AdminInstructor/GetTracksByBranch?branchId=' + branchId)
            .then(function(response) { return response.json(); })
            .then(function(data) {
                var options = '<option value="">-- Select Track --</option>';

                if (data && data.length > 0) {
                    for (var i = 0; i < data.length; i++) {
                        options += '<option value="' + data[i].value + '">' + data[i].text + '</option>';
                    }
                }

                trackDropdown.innerHTML = options;

                // Update hidden field
                document.getElementsByName('TrackName')[0].value = 'Selected Track';
                document.getElementsByName('BranchName')[0].value = document.getElementById('BranchId').options[document.getElementById('BranchId').selectedIndex].text;
            })
            .catch(function(error) {
                console.error('Error:', error);
                trackDropdown.innerHTML = '<option value="">-- Error loading tracks --</option>';
            });
    }
</script>
