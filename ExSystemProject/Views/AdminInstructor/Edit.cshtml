@model ExSystemProject.DTOS.InstructorDTO
@{
    ViewData["Title"] = "Edit Instructor";
    Layout = "_AdminLayout";
}

<div class="container-fluid">
    <h2>Edit Instructor</h2>

    <div class="card">
        <div class="card-header">
            <i class="fas fa-user-edit me-1"></i>
            Edit Instructor Information
        </div>
        <div class="card-body">
            <form asp-action="Edit" method="post">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" asp-for="InsId" />
                <input type="hidden" asp-for="UserId" />

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Username" class="control-label">Username</label>
                            <input asp-for="Username" class="form-control" />
                            <span asp-validation-for="Username" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Email" class="control-label">Email</label>
                            <input asp-for="Email" class="form-control" type="email" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Gender" class="control-label">Gender</label>
                            <select asp-for="Gender" class="form-select">
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                            </select>
                            <span asp-validation-for="Gender" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="Salary" class="control-label">Salary</label>
                            <input asp-for="Salary" class="form-control" type="number" step="0.01" min="0" />
                            <span asp-validation-for="Salary" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="BranchId" class="control-label">Branch</label>
                            <select id="BranchId" name="BranchId" class="form-select" asp-items="ViewBag.Branches" required>
                                <option value="">-- Select Branch --</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp-for="TrackId" class="control-label">Track</label>
                            <select asp-for="TrackId" class="form-select" asp-items="ViewBag.Tracks" required>
                                <option value="">-- Select Track --</option>
                            </select>
                            <span asp-validation-for="TrackId" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="form-check mb-3">
                    <input asp-for="Isactive" class="form-check-input" />
                    <label asp-for="Isactive" class="form-check-label">Is Active</label>
                </div>

                <div class="form-group">
                    <input type="submit" value="Save Changes" class="btn btn-primary" />
                    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            // Set initial branch value
            var branchId = '@Model.BranchId';
            if (branchId) {
                $('#BranchId').val(branchId);
            }

            // Branch change handler to update tracks dropdown
            $('#BranchId').change(function() {
                var branchId = $(this).val();
                if (branchId) {
                    $.getJSON('@Url.Action("GetTracksByBranch", "AdminInstructor")', { branchId: branchId }, function(data) {
                        var trackSelect = $('#TrackId');
                        trackSelect.empty();
                        trackSelect.append($('<option>').val('').text('-- Select Track --'));
                        $.each(data, function(index, item) {
                            trackSelect.append($('<option>').val(item.trackId).text(item.trackName));
                        });

                        // Restore track selection if applicable
                        var trackId = '@Model.TrackId';
                        if (trackId) {
                            trackSelect.val(trackId);
                        }
                    });
                } else {
                    $('#TrackId').empty().append($('<option>').val('').text('-- Select Track --'));
                }
            });

            // Trigger branch change on page load to load relevant tracks
            $('#BranchId').trigger('change');
        });
    </script>
}